{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/InfoKelas/frontend/app/api/auth/login/route.js"],"sourcesContent":["// routes/login.js\r\nimport db from \"@/lib/db\";\r\nimport bcrypt from \"bcrypt\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"ini_rahasia\"; // simpan di .env\r\n\r\nexport async function POST(req) {\r\n  const { username, password } = await req.json();\r\n\r\n  if (!username || !password) {\r\n    return NextResponse.json({ message: \"Field tidak lengkap\" }, { status: 400 });\r\n  }\r\n\r\n  return new Promise((resolve) => {\r\n    db.get(\"SELECT * FROM users WHERE username = ?\", [username], async (err, user) => {\r\n      if (err || !user) {\r\n        return resolve(NextResponse.json({ message: \"Username atau password salah\" }, { status: 401 }));\r\n      }\r\n\r\n      const isValid = await bcrypt.compare(password, user.password);\r\n      if (!isValid) {\r\n        return resolve(NextResponse.json({ message: \"Username atau password salah\" }, { status: 401 }));\r\n      }\r\n\r\n      // Buat token JWT\r\n      const token = jwt.sign({ id: user.id, username: user.username, role: user.role }, JWT_SECRET, { expiresIn: \"8h\" });\r\n\r\n      return resolve(NextResponse.json({ token, role: user.role }));\r\n    });\r\n  });\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;;;;;;;;;;;;;;;;AAIlB;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI,eAAe,iBAAiB;AAEtE,eAAe,KAAK,GAAG;IAC5B,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;IAE7C,IAAI,CAAC,YAAY,CAAC,UAAU;QAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC7E;IAEA,OAAO,IAAI,QAAQ,CAAC;QAClB,GAAG,GAAG,CAAC,0CAA0C;YAAC;SAAS,EAAE,OAAO,KAAK;YACvE,IAAI,OAAO,CAAC,MAAM;gBAChB,OAAO,QAAQ,gJAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;gBAA+B,GAAG;oBAAE,QAAQ;gBAAI;YAC9F;YAEA,MAAM,UAAU,MAAM,OAAO,OAAO,CAAC,UAAU,KAAK,QAAQ;YAC5D,IAAI,CAAC,SAAS;gBACZ,OAAO,QAAQ,gJAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;gBAA+B,GAAG;oBAAE,QAAQ;gBAAI;YAC9F;YAEA,iBAAiB;YACjB,MAAM,QAAQ,IAAI,IAAI,CAAC;gBAAE,IAAI,KAAK,EAAE;gBAAE,UAAU,KAAK,QAAQ;gBAAE,MAAM,KAAK,IAAI;YAAC,GAAG,YAAY;gBAAE,WAAW;YAAK;YAEhH,OAAO,QAAQ,gJAAY,CAAC,IAAI,CAAC;gBAAE;gBAAO,MAAM,KAAK,IAAI;YAAC;QAC5D;IACF;AACF"}}]
}